<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Помняша</title>

    <script src="https://kit.fontawesome.com/137af2dcfa.js" crossorigin="anonymous"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@300;400;500;700;800&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="css/main.css">
</head>
<body>
    <main>
        <h1 id="welcome-title">Добро пожаловать</h1>

        <div>
            <i class="fa-brands fa-google"></i>
            <a href="http://localhost:8000/auth/google/url">Войти через Google</a>
        </div>
    </main>
    <footer>
        <div>
            <div>
                <i class="fa-regular fa-calendar"></i>
                <i class="fa-regular fa-comments"></i>
                <i class="fa-solid fa-chart-pie"></i>
            </div>
        </div>
    </footer>

    <script>
        window.addEventListener('DOMContentLoaded', () => {
        const queryParams = new URLSearchParams(window.location.search);
        const code = queryParams.get('code');

        if (code) {
        fetch('http://localhost:8000/auth/google/callback', {
            method: 'POST',
            headers: {
            'Content-Type': 'application/json'
            },
            body: JSON.stringify({ code: code })
        })
        .then(response => response.json())
        .then(data => {
            const userName = data.user.name;
            const title = document.getElementById('welcome-title');
            title.textContent = `Добро пожаловать, ${userName}!`;
        })
        .catch(error => {
            console.error('Ошибка при получении данных пользователя:', error);
        });
        } else {
        console.log('Нет параметра code');
        }
    });
</script>


</body>
</html>